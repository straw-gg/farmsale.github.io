import{d as e,r as a,q as l,z as t,I as s,c as i,e as r,l as u,w as o,b as d,s as c,t as n,J as v,g as p,F as m,j as g,o as f,K as y}from"./vendor.C8p9HwzL.js";import{u as b,p as k,_}from"./index.BOTQRBFr.js";const w={class:"product-detail"},h={key:0,class:"loading"},V={key:1,class:"error"},x={key:2,class:"product-content"},I={class:"product-images"},D=["src","alt"],E={class:"product-info"},P={class:"title"},q={class:"price-section"},j={class:"current-price"},F={key:0,class:"original-price"},N={key:0,class:"specs"},U={class:"actions"},A={class:"details"},C={class:"intro"},$=_(e({__name:"ProductDetail",setup(e){const _=t(),$=b(),z=a(!0),J=a(""),K=a(1),T=a(""),B=a("intro"),G=a(!1),H=l((()=>{const e=_.query.id;if(!e)throw new Error("缺少商品ID参数");if(Array.isArray(e))throw new Error("参数格式错误：ID不能为数组");const a=Number(e);if(isNaN(a))throw new Error("无效的商品ID格式");if(!/^[1-9]\d*$/.test(e))throw new Error("商品ID必须为正整数");return a})),L=l((()=>{try{return k.find((e=>e.id===H.value))||{id:0,title:"商品不存在",price:0,intro:"请检查商品链接",image:"",category:"",stock:0,parameters:{},specs:[],originalPrice:0,discount:""}}catch(e){return J.value=e.message,{id:0,title:"参数错误",price:0,intro:e.message,image:"",category:"",stock:0,parameters:{},specs:[],originalPrice:0,discount:""}}})),M=()=>{var e;if(0!==L.value.id){if((null==(e=L.value.specs)?void 0:e.length)&&!T.value)return G.value=!0,void y.warning("请选择商品规格");$.addItem({id:L.value.id,title:L.value.title,price:L.value.price,quantity:K.value,spec:T.value,image:L.value.image}),y.success(`已添加 ${K.value} 件商品到购物车`),K.value=1}},O=()=>{J.value="",Q()},Q=()=>{try{z.value=!0,J.value="";const e=H.value;setTimeout((()=>{if(!k.some((a=>a.id===e)))throw new Error("找不到该商品");z.value=!1}),500)}catch(e){J.value=e.message,z.value=!1}};return s((()=>_.query.id),(()=>{Q()}),{immediate:!0}),(e,a)=>{const l=u("el-skeleton"),t=u("el-button"),s=u("el-result"),y=u("el-tag"),b=u("el-radio"),k=u("el-radio-group"),_=u("el-input-number"),$=u("el-tab-pane"),G=u("el-descriptions-item"),H=u("el-descriptions"),Q=u("el-tabs");return f(),i("div",w,[z.value?(f(),i("div",h,[r(l,{rows:5,animated:""})])):J.value?(f(),i("div",V,[r(s,{icon:"error",title:"商品加载失败","sub-title":J.value},{extra:o((()=>[r(t,{type:"primary",onClick:O},{default:o((()=>a[3]||(a[3]=[p("重试")]))),_:1})])),_:1},8,["sub-title"])])):(f(),i("div",x,[d("div",I,[d("img",{src:L.value.image,alt:L.value.title},null,8,D)]),d("div",E,[d("h1",P,n(L.value.title),1),d("div",q,[d("span",j,"¥"+n(L.value.price.toFixed(2)),1),L.value.originalPrice?(f(),i("span",F," ¥"+n(L.value.originalPrice.toFixed(2)),1)):c("",!0),L.value.discount?(f(),v(y,{key:1,type:"danger"},{default:o((()=>[p(n(L.value.discount)+"折 ",1)])),_:1})):c("",!0)]),L.value.specs?(f(),i("div",N,[a[4]||(a[4]=d("h3",null,"规格选择",-1)),r(k,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=e=>T.value=e)},{default:o((()=>[(f(!0),i(m,null,g(L.value.specs,(e=>(f(),v(b,{key:e,value:e,label:e,border:""},{default:o((()=>[p(n(e),1)])),_:2},1032,["value","label"])))),128))])),_:1},8,["modelValue"])])):c("",!0),d("div",U,[r(_,{modelValue:K.value,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value=e),min:1,max:L.value.stock},null,8,["modelValue","max"]),r(t,{type:"danger",onClick:M,disabled:L.value.stock<=0},{default:o((()=>[p(n(L.value.stock>0?"加入购物车":"已售罄"),1)])),_:1},8,["disabled"])]),d("div",A,[r(Q,{modelValue:B.value,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value=e)},{default:o((()=>[r($,{label:"商品介绍",name:"intro"},{default:o((()=>[d("p",C,n(L.value.intro),1)])),_:1}),r($,{label:"规格参数",name:"specs"},{default:o((()=>[r(H,{border:""},{default:o((()=>[(f(!0),i(m,null,g(L.value.parameters,((e,a)=>(f(),v(G,{key:a,label:a},{default:o((()=>[p(n(e),1)])),_:2},1032,["label"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])])]))])}}}),[["__scopeId","data-v-8db03efd"]]);export{$ as default};
